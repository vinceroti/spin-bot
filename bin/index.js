"use strict";var _discord=_interopRequireDefault(require("discord.js")),_helpers=require("./helpers"),_asyncRedis=_interopRequireDefault(require("async-redis"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}require("dotenv").config();var redisClient=_asyncRedis["default"].createClient(),discordClient=new _discord["default"].Client;redisClient.on("error",function(a){console.error(a)}),discordClient.on("error",function(a){console.error(a)}),discordClient.on("ready",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:console.log("Logged in...");case 1:case"end":return a.stop();}},a)})));var prefix="!";discordClient.on("message",/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d,e,f,g,h,i,j,k,l;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!b.author.bot){a.next=2;break}return a.abrupt("return");case 2:if(b.content.startsWith(prefix)){a.next=4;break}return a.abrupt("return");case 4:if(b.guild){a.next=6;break}return a.abrupt("return",b.channel.send("This bot currently only supports commands sent within a channel"));case 6:if(c=b.content.slice(prefix.length),d=c.split(" "),e=d.shift().toLowerCase(),f=b.guild.id,"spin"===e){a.next=12;break}return a.abrupt("return");case 12:if(d.length){a.next=25;break}return a.next=15,(0,_helpers.getList)(redisClient,f);case 15:if(g=a.sent,g){a.next=18;break}return a.abrupt("return",b.channel.send("No games exist, add them with - '!spin -add Game Title'"));case 18:return a.next=20,b.channel.send("Spinning...");case 20:return a.next=22,(0,_helpers.sleep)(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,b.channel.send("What could it be...");case 2:case"end":return a.stop();}},a)})),2e3);case 22:return a.next=24,(0,_helpers.sleep)(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){var c=Math.floor;for(;;)switch(a.prev=a.next){case 0:return a.next=2,b.channel.send("You Got ".concat(g[c(Math.random()*g.length)]));case 2:case"end":return a.stop();}},a)})),2e3);case 24:return a.abrupt("return");case 25:if(!(d.length&&d.includes("-list"))){a.next=32;break}return a.next=28,(0,_helpers.getList)(redisClient,f);case 28:if(h=a.sent,h){a.next=31;break}return a.abrupt("return",b.channel.send("No games found"));case 31:return a.abrupt("return",b.channel.send("Listing Games - ".concat(h)));case 32:if(!(d.length&&d.includes("-add"))){a.next=48;break}if(i=c.split("-add ")[1],i&&i.length){a.next=36;break}return a.abrupt("return");case 36:return a.prev=36,a.next=39,redisClient.rpush(f,i);case 39:b.channel.send("".concat(i," added!")),a.next=47;break;case 42:return a.prev=42,a.t0=a["catch"](36),console.error(a.t0),a.next=47,b.channel.send("Error - ".concat(a.t0));case 47:return a.abrupt("return");case 48:if(!(d.length&&d.includes("-deleteAll"))){a.next=65;break}return a.next=51,(0,_helpers.getList)(redisClient,f);case 51:if(j=a.sent,j){a.next=54;break}return a.abrupt("return",b.channel.send("No games exist"));case 54:a.prev=54,j.forEach(/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,redisClient.lrem(f,0,b);case 2:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}()),b.channel.send("Entries Successfully Deleted"),a.next=64;break;case 59:return a.prev=59,a.t1=a["catch"](54),console.error(a.t1),a.next=64,b.channel.send("Error - ".concat(a.t1));case 64:return a.abrupt("return");case 65:if(!(d.length&&d.includes("-delete"))){a.next=82;break}if(k=c.split("-delete ")[1],k&&k.length){a.next=69;break}return a.abrupt("return");case 69:return a.prev=69,a.next=72,redisClient.lrem(f,0,k);case 72:l=a.sent,b.channel.send(l?"'".concat(k,"' Successfully Deleted"):"No Entry Found"),a.next=81;break;case 76:return a.prev=76,a.t2=a["catch"](69),console.error(a.t2),a.next=81,b.channel.send("Error - ".concat(a.t2));case 81:return a.abrupt("return");case 82:return a.next=84,b.channel.send("Invalid spin command");case 84:case"end":return a.stop();}},a,null,[[36,42],[54,59],[69,76]])}));return function(){return a.apply(this,arguments)}}()),discordClient.login(process.env.token);